# Pre-commit hooks for EcoNeTool
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
# Update hooks: pre-commit autoupdate

default_language_version:
  python: python3

repos:
  # ==========================================================================
  # General file hygiene
  # ==========================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
        exclude: '\.Rdata$|\.rds$|\.ewemdb$'
      - id: check-yaml
        args: [--allow-multiple-documents]
      - id: check-json
      - id: check-added-large-files
        args: ['--maxkb=1000']  # Warn on files > 1MB
      - id: check-merge-conflict
      - id: mixed-line-ending
        args: [--fix=lf]
        exclude: '\.bat$'

  # ==========================================================================
  # Shell script linting
  # ==========================================================================
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.6
    hooks:
      - id: shellcheck
        args: [--severity=warning, --shell=bash]
        files: \.(sh|bash)$

  # ==========================================================================
  # Repo hygiene checks (custom local hooks)
  # ==========================================================================
  - repo: local
    hooks:
      # Prevent DEBUG prints from being committed
      - id: no-debug-prints
        name: Check for DEBUG prints
        entry: 'grep -n "DEBUG:" --include="*.R" --include="*.sh" -r . && exit 1 || exit 0'
        language: system
        pass_filenames: false
        types: [file]

      # Prevent .Rproj.user from being committed
      - id: no-rproj-user
        name: Check for .Rproj.user files
        entry: 'test -z "$(git ls-files .Rproj.user)" || (echo "ERROR: .Rproj.user files are tracked" && exit 1)'
        language: system
        pass_filenames: false

      # Check for large binary files
      - id: no-large-binaries
        name: Check for large binary files
        entry: 'git diff --cached --name-only | grep -E "\.(ewemdb|eweaccdb|zip)$" && echo "WARNING: Binary file staged" && exit 1 || exit 0'
        language: system
        pass_filenames: false

# ==========================================================================
# R Linting (optional - requires R and lintr package)
# ==========================================================================
# Uncomment below if you have R and lintr installed:
#
#  - repo: https://github.com/lorenzwalthert/precommit
#    rev: v0.4.0
#    hooks:
#      - id: lintr
#        args: [--warn_only]
#      - id: style-files
#        args: [--ignore-start="# styler: off", --ignore-stop="# styler: on"]

# ==========================================================================
# CI/CD Integration Notes
# ==========================================================================
# For GitHub Actions, add this to your workflow:
#
# - name: Run pre-commit
#   uses: pre-commit/action@v3.0.0
#
# Or run manually in CI:
#   pip install pre-commit
#   pre-commit run --all-files
